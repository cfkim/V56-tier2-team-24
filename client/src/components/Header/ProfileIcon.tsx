import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { logout } from "../../lib/api";
import type { Role } from "../../types/Role";

export default function ProfileIcon({
  setIsLoggedIn,
  setUser,
  role,
  forSidebar = false,
}: {
  setIsLoggedIn: React.Dispatch<React.SetStateAction<boolean>>;
  setUser: React.Dispatch<React.SetStateAction<any>>;
  role: Role | undefined;
  forSidebar?: boolean;
}) {
  const [isOpen, setIsOpen] = useState(false);

  const navigate = useNavigate();

  const handleLogout = () => {
    setIsLoggedIn(false);
    setIsOpen(!isOpen);
    setUser(null);
    // clears session tokens
    if (role === "guest") {
      navigate("/");
    } else {
      logout();
    }
  };

  return (
    <>
      <button className="z-10 hidden cursor-pointer sm:block">
        {isOpen ? (
          <div className="relative cursor-pointer flex-col">
            <svg
              onClick={() => setIsOpen(!isOpen)}
              className="text-primary"
              width="70"
              height="50"
              viewBox="0 0 70 50"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle cx="25" cy="25" r="25" fill="currentColor" />
              <path
                d="M21.534 25.07C21.6569 25.0175 21.7892 24.9903 21.9228 24.9898C22.0565 24.9893 22.1889 25.0156 22.3122 25.0672C22.4355 25.1188 22.5473 25.1945 22.6408 25.29C22.7344 25.3855 22.8078 25.4988 22.8568 25.6231C22.9058 25.7475 22.9294 25.8804 22.9262 26.014C22.9229 26.1477 22.8929 26.2793 22.8379 26.4011C22.7829 26.523 22.7041 26.6325 22.606 26.7234C22.508 26.8142 22.3927 26.8845 22.267 26.93C21.5985 27.1934 21.0248 27.6519 20.6205 28.2458C20.2162 28.8397 20 29.5415 20 30.26V32C20 32.2652 20.1054 32.5196 20.2929 32.7071C20.4804 32.8946 20.7348 33 21 33H29C29.2652 33 29.5196 32.8946 29.7071 32.7071C29.8946 32.5196 30 32.2652 30 32V30.353C30.0001 29.6115 29.7749 28.8874 29.3541 28.2768C28.9334 27.6662 28.337 27.1979 27.644 26.934C27.5175 26.8901 27.4012 26.8213 27.3018 26.7316C27.2024 26.6419 27.1221 26.5332 27.0655 26.4119C27.009 26.2905 26.9773 26.1591 26.9725 26.0253C26.9677 25.8916 26.9897 25.7582 27.0374 25.6331C27.0851 25.508 27.1574 25.3938 27.25 25.2972C27.3427 25.2006 27.4538 25.1235 27.5767 25.0706C27.6997 25.0177 27.832 24.9901 27.9659 24.9893C28.0998 24.9885 28.2324 25.0146 28.356 25.066C29.4276 25.4742 30.3499 26.1983 31.0006 27.1425C31.6514 28.0867 31.9999 29.2063 32 30.353V32C32 32.7956 31.6839 33.5587 31.1213 34.1213C30.5587 34.6839 29.7956 35 29 35H21C20.2044 35 19.4413 34.6839 18.8787 34.1213C18.3161 33.5587 18 32.7956 18 32V30.26C18.0001 29.1402 18.3373 28.0463 18.9676 27.1206C19.5978 26.195 20.4921 25.4805 21.534 25.07ZM25 15C26.0609 15 27.0783 15.4214 27.8284 16.1716C28.5786 16.9217 29 17.9391 29 19V21C29 22.0609 28.5786 23.0783 27.8284 23.8284C27.0783 24.5786 26.0609 25 25 25C23.9391 25 22.9217 24.5786 22.1716 23.8284C21.4214 23.0783 21 22.0609 21 21V19C21 17.9391 21.4214 16.9217 22.1716 16.1716C22.9217 15.4214 23.9391 15 25 15V15ZM25 17C24.4696 17 23.9609 17.2107 23.5858 17.5858C23.2107 17.9609 23 18.4696 23 19V21C23 21.5304 23.2107 22.0391 23.5858 22.4142C23.9609 22.7893 24.4696 23 25 23C25.5304 23 26.0391 22.7893 26.4142 22.4142C26.7893 22.0391 27 21.5304 27 21V19C27 18.4696 26.7893 17.9609 26.4142 17.5858C26.0391 17.2107 25.5304 17 25 17Z"
                fill="white"
              />
              <path
                d="M61.9572 21.977L68.0515 31.7069L55.9272 31.7469L61.9572 21.977Z"
                fill="currentColor"
              />
            </svg>
            <div className="text-background bg-primary absolute top-full right-0 mt-2 flex h-12 w-36 cursor-pointer items-center justify-between rounded-xl px-4 text-xl">
              <span onClick={handleLogout} className="flex-1 text-center">
                Log out
              </span>
              <svg
                onClick={() => setIsOpen(!isOpen)}
                className="h-5 w-5"
                viewBox="0 0 52 52"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M29.4471 25.9998L39.0955 16.3514C39.5535 15.8943 39.811 15.274 39.8116 14.627C39.8122 13.98 39.5557 13.3592 39.0986 12.9013C38.6415 12.4434 38.0212 12.1858 37.3742 12.1853C36.7272 12.1847 36.1064 12.4412 35.6485 12.8983L26.0001 22.5467L16.3516 12.8983C15.8937 12.4404 15.2727 12.1831 14.6251 12.1831C13.9775 12.1831 13.3564 12.4404 12.8985 12.8983C12.4406 13.3562 12.1833 13.9772 12.1833 14.6248C12.1833 15.2724 12.4406 15.8935 12.8985 16.3514L22.547 25.9998L12.8985 35.6483C12.4406 36.1062 12.1833 36.7272 12.1833 37.3748C12.1833 38.0224 12.4406 38.6435 12.8985 39.1014C13.3564 39.5593 13.9775 39.8166 14.6251 39.8166C15.2727 39.8166 15.8937 39.5593 16.3516 39.1014L26.0001 29.453L35.6485 39.1014C36.1064 39.5593 36.7275 39.8166 37.3751 39.8166C38.0227 39.8166 38.6437 39.5593 39.1016 39.1014C39.5596 38.6435 39.8168 38.0224 39.8168 37.3748C39.8168 36.7272 39.5596 36.1062 39.1016 35.6483L29.4471 25.9998Z"
                  fill="currentColor"
                />
              </svg>
            </div>
          </div>
        ) : (
          <svg
            className="text-primary h-8 w-10 sm:h-9 sm:w-11 md:h-10 md:w-12 lg:h-11 lg:w-14 xl:h-12 xl:w-16"
            onClick={() => setIsOpen(true)}
            viewBox="0 0 70 50"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="25" cy="25" r="25" fill="currentColor" />
            <path
              d="M21.534 25.07C21.6569 25.0175 21.7892 24.9903 21.9228 24.9898C22.0565 24.9893 22.1889 25.0156 22.3122 25.0672C22.4355 25.1188 22.5473 25.1945 22.6408 25.29C22.7344 25.3855 22.8078 25.4988 22.8568 25.6231C22.9058 25.7475 22.9294 25.8804 22.9262 26.014C22.9229 26.1477 22.8929 26.2793 22.8379 26.4011C22.7829 26.523 22.7041 26.6325 22.606 26.7234C22.508 26.8142 22.3927 26.8845 22.267 26.93C21.5985 27.1934 21.0248 27.6519 20.6205 28.2458C20.2162 28.8397 20 29.5415 20 30.26V32C20 32.2652 20.1054 32.5196 20.2929 32.7071C20.4804 32.8946 20.7348 33 21 33H29C29.2652 33 29.5196 32.8946 29.7071 32.7071C29.8946 32.5196 30 32.2652 30 32V30.353C30.0001 29.6115 29.7749 28.8874 29.3541 28.2768C28.9334 27.6662 28.337 27.1979 27.644 26.934C27.5175 26.8901 27.4012 26.8213 27.3018 26.7316C27.2024 26.6419 27.1221 26.5332 27.0655 26.4119C27.009 26.2905 26.9773 26.1591 26.9725 26.0253C26.9677 25.8916 26.9897 25.7582 27.0374 25.6331C27.0851 25.508 27.1574 25.3938 27.25 25.2972C27.3427 25.2006 27.4538 25.1235 27.5767 25.0706C27.6997 25.0177 27.832 24.9901 27.9659 24.9893C28.0998 24.9885 28.2324 25.0146 28.356 25.066C29.4276 25.4742 30.3499 26.1983 31.0006 27.1425C31.6514 28.0867 31.9999 29.2063 32 30.353V32C32 32.7956 31.6839 33.5587 31.1213 34.1213C30.5587 34.6839 29.7956 35 29 35H21C20.2044 35 19.4413 34.6839 18.8787 34.1213C18.3161 33.5587 18 32.7956 18 32V30.26C18.0001 29.1402 18.3373 28.0463 18.9676 27.1206C19.5978 26.195 20.4921 25.4805 21.534 25.07ZM25 15C26.0609 15 27.0783 15.4214 27.8284 16.1716C28.5786 16.9217 29 17.9391 29 19V21C29 22.0609 28.5786 23.0783 27.8284 23.8284C27.0783 24.5786 26.0609 25 25 25C23.9391 25 22.9217 24.5786 22.1716 23.8284C21.4214 23.0783 21 22.0609 21 21V19C21 17.9391 21.4214 16.9217 22.1716 16.1716C22.9217 15.4214 23.9391 15 25 15V15ZM25 17C24.4696 17 23.9609 17.2107 23.5858 17.5858C23.2107 17.9609 23 18.4696 23 19V21C23 21.5304 23.2107 22.0391 23.5858 22.4142C23.9609 22.7893 24.4696 23 25 23C25.5304 23 26.0391 22.7893 26.4142 22.4142C26.7893 22.0391 27 21.5304 27 21V19C27 18.4696 26.7893 17.9609 26.4142 17.5858C26.0391 17.2107 25.5304 17 25 17Z"
              fill="white"
            />
            <path
              d="M62.0428 34.023L55.9485 24.2931L68.0728 24.2531L62.0428 34.023Z"
              fill="currentColor"
            />
          </svg>
        )}
      </button>
      {forSidebar && (
        <div className="flex cursor-pointer items-center underline sm:hidden">
          <button>
            <svg
              width="70"
              height="50"
              viewBox="0 0 70 50"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle cx="25" cy="25" r="25" fill="#082368" />
              <path
                d="M21.534 25.07C21.6569 25.0175 21.7892 24.9903 21.9228 24.9898C22.0565 24.9893 22.1889 25.0156 22.3122 25.0672C22.4355 25.1188 22.5473 25.1945 22.6408 25.29C22.7344 25.3855 22.8078 25.4988 22.8568 25.6231C22.9058 25.7475 22.9294 25.8804 22.9262 26.014C22.9229 26.1477 22.8929 26.2793 22.8379 26.4011C22.7829 26.523 22.7041 26.6325 22.606 26.7234C22.508 26.8142 22.3927 26.8845 22.267 26.93C21.5985 27.1934 21.0248 27.6519 20.6205 28.2458C20.2162 28.8397 20 29.5415 20 30.26V32C20 32.2652 20.1054 32.5196 20.2929 32.7071C20.4804 32.8946 20.7348 33 21 33H29C29.2652 33 29.5196 32.8946 29.7071 32.7071C29.8946 32.5196 30 32.2652 30 32V30.353C30.0001 29.6115 29.7749 28.8874 29.3541 28.2768C28.9334 27.6662 28.337 27.1979 27.644 26.934C27.5175 26.8901 27.4012 26.8213 27.3018 26.7316C27.2024 26.6419 27.1221 26.5332 27.0655 26.4119C27.009 26.2905 26.9773 26.1591 26.9725 26.0253C26.9677 25.8916 26.9897 25.7582 27.0374 25.6331C27.0851 25.508 27.1574 25.3938 27.25 25.2972C27.3427 25.2006 27.4538 25.1235 27.5767 25.0706C27.6997 25.0177 27.832 24.9901 27.9659 24.9893C28.0998 24.9885 28.2324 25.0146 28.356 25.066C29.4276 25.4742 30.3499 26.1983 31.0006 27.1425C31.6514 28.0867 31.9999 29.2063 32 30.353V32C32 32.7956 31.6839 33.5587 31.1213 34.1213C30.5587 34.6839 29.7956 35 29 35H21C20.2044 35 19.4413 34.6839 18.8787 34.1213C18.3161 33.5587 18 32.7956 18 32V30.26C18.0001 29.1402 18.3373 28.0463 18.9676 27.1206C19.5978 26.195 20.4921 25.4805 21.534 25.07ZM25 15C26.0609 15 27.0783 15.4214 27.8284 16.1716C28.5786 16.9217 29 17.9391 29 19V21C29 22.0609 28.5786 23.0783 27.8284 23.8284C27.0783 24.5786 26.0609 25 25 25C23.9391 25 22.9217 24.5786 22.1716 23.8284C21.4214 23.0783 21 22.0609 21 21V19C21 17.9391 21.4214 16.9217 22.1716 16.1716C22.9217 15.4214 23.9391 15 25 15V15ZM25 17C24.4696 17 23.9609 17.2107 23.5858 17.5858C23.2107 17.9609 23 18.4696 23 19V21C23 21.5304 23.2107 22.0391 23.5858 22.4142C23.9609 22.7893 24.4696 23 25 23C25.5304 23 26.0391 22.7893 26.4142 22.4142C26.7893 22.0391 27 21.5304 27 21V19C27 18.4696 26.7893 17.9609 26.4142 17.5858C26.0391 17.2107 25.5304 17 25 17Z"
                fill="white"
              />
            </svg>
          </button>
          <span onClick={handleLogout}>Logout</span>
        </div>
      )}
    </>
  );
}
